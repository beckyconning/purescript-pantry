"use strict";
var $foreign = require("./foreign");
var Control_Monad_Aff = require("Control.Monad.Aff");
var Prelude = require("Prelude");
var Test_Spec_Console = require("Test.Spec.Console");
var Control_Monad_Eff_Console = require("Control.Monad.Eff.Console");
var Data_Foldable = require("Data.Foldable");
var Control_Monad = require("Control.Monad");
var Test_Spec_Summary = require("Test.Spec.Summary");
var Test_Spec = require("Test.Spec");
var Control_Monad_Eff = require("Control.Monad.Eff");
var Test_Spec_Reporter = require("Test.Spec.Reporter");
var Control_Monad_Eff_Exception = require("Control.Monad.Eff.Exception");

/**
 *  Runs the tests and invoke all reporters.
 *  If run in a NodeJS environment any failed test will cause the
 *  process to exit with a non-zero exit code.
 */
var run = function (rs) {
    return function (spec) {
        return Control_Monad_Aff.runAff(function (err) {
            return function __do() {
                Test_Spec_Console.withAttrs([ 31 ])(Control_Monad_Eff_Console.print(Control_Monad_Eff_Exception.showError)(err))();
                return $foreign.exit(1)();
            };
        })(function (results) {
            return function __do() {
                Data_Foldable.sequence_(Control_Monad_Eff.applicativeEff)(Data_Foldable.foldableArray)(Prelude.map(Prelude.functorArray)(function (f) {
                    return f(results);
                })(rs))();
                return Control_Monad.when(Control_Monad_Eff.monadEff)(Prelude.not(Prelude.booleanAlgebraBoolean)(Test_Spec_Summary.successful(results)))($foreign.exit(1))();
            };
        })(Test_Spec.collect(spec));
    };
};
module.exports = {
    run: run
};
